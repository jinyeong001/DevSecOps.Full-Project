# WEB 구축

## WebPage 소스코드
---
직접 생성하거나, Window PowerShell을 이용하는 방법 두 가지가 있습니다.

###### **방법 1) 직접 생성**
1. DevSecOps폴더에 Web폴더 생성 후, 웹 소스코드 복사
[DevSecOps Team Web Source code](https://github.com/GH6679/web_wargamer)

2. Github의 특수문자를 허용하기 위한 설정
Window PowerShell 관리자 권한 실행
```md
# DevSecOps\Web폴더로 이동
1. cd C:\Users\Administrator\Desktop\DevSecOps\Web

# Github 특수문자 허용
2. git config core.protectNTFS false
```
3. DevSecOps폴더에 k8s-yaml 폴더 생성
<br>

###### **방법 2) Window PowerShell 사용**
Window PowerShell 관리자 권한 실행
```md
# DevSecOps폴더 이동
1. cd C:\Users\Administrator\Desktop\DevSecOps

# 소스코드 클론 
2. git clone https://github.com/GH6679/web_wargamer.git
3. cd web_wargamer 

# 깃허브 안에 있는 특수문자들 허용으로 설정 
4. git config core.protectNTFS false 
5. cd .. 

# k8s-yaml 디렉토리 생성 
6. mkdir k8s-yaml
```
<br><br><br>

## Web worker node 생성
---

###### **1) web-deployment.yaml 파일 생성**
web-deployment.yaml 파일은 웹 worker node 설정 파일이다.
k8s-yaml 폴더에 web-deployment.yaml 파일 생성 후, 아래 코드 작성
<mdf>web-deployment.yaml</mdf>

###### **2) db-deployment.yaml 파일 생성**
db-deployment.yaml 파일은 웹 데이터베이스 worker node 설정 파일이다.
k8s-yaml 폴더에 db-deployment.yaml 파일 생성 후, 아래 코드 작성
<mdf>db-deployment.yaml</mdf>

###### **3) db-init-configmap.yaml 파일 생성**
db-init-configmap.yaml 파일은 웹 데이터베이스 worker node의 초기화 설정 파일이다.
k8s-yaml 폴더에 db-init-configmap.yaml 파일 생성 후, 아래 코드 작성
<mdf>db-init-configmap.yaml</mdf>

###### **4) service.yaml 파일 생성**
service.yaml 파일은 웹과 데이터베이스의 연동을 위한 설정 파일이다.
k8s-yaml 폴더에 service.yaml 파일 생성 후, 아래 코드 작성
<mdf>service.yaml</mdf>
<br>

## Web worker node 실행
---
###### **1) 클러스터 삭제 및 kind 클러스터 생성**
Window PowerShell 관리자 권한 실행
```
# DevSecOps폴더로 이동
1. cd C:\Users\Administrator\Desktop\DevSecOps

# 클러스터 삭제 명령어
2. kind delete cluster --name devsecops-cluster
3. kind delete clusters -–all

# kind 클러스터 생성
4. kind create cluster --name devsecops-cluster --config k8s-yaml/kind-config.yaml

# 노드 상태 확인
5. kubectl get nodes --show-labels
```

Web 이미지 빌드 및 kind 클러스터로 로드
```
# 웹 애플리케이션 이미지 빌드
1. docker build -t wargame-web:latest .

# 빌드된 이미지를 kind 클러스터로 로드
2. kind load docker-image wargame-web:latest --name devsecops-cluster
```

디플로이먼트와 서비스 배포
```
# deployment, service yaml 파일 배포
1. kubectl apply -f k8s-yaml/db-deployment.yaml
2. kubectl apply -f k8s-yaml/web-deployment.yaml
3. kubectl apply -f k8s-yaml/services.yaml

# 배포 상태 확인
4. kubectl get pods -o wide
5. kubectl get services
```

###### **2) 웹 페이지 접속**
```
browser 주소창: localhost:30080 or http://Windows Host IP:30080
```
